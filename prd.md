# PRD: Landing Font QA (Chrome Extension)

## 1. 목적
랜딩페이지 QA 과정에서 **현재 화면(뷰포트)에 실제로 보이는 텍스트들의 `font-size`, `font-weight`, `color`를 즉시 확인**할 수 있도록, 텍스트 요소 위에 말풍선(배지) 형태로 표시하는 **최소 기능 크롬 익스텐션**을 만든다.

## 2. 핵심 가치
- 디자이너/QA가 개발자 도구 없이도 폰트 스펙을 빠르게 확인
- 화면에 보이는 텍스트를 “전부” 훑어 스펙 불일치 탐지
- 설치/사용 흐름 단순 (클릭으로 On/Off)

## 3. 대상 사용자
- 프론트엔드 개발자
- 퍼블리셔/디자이너
- QA 담당자

## 4. 사용 시나리오
1) 사용자가 랜딩페이지 접속  
2) 확장 아이콘 클릭 → 오버레이 ON  
3) 뷰포트에 보이는 텍스트들 위에 `font-size / font-weight` 배지가 표시됨  
4) 스크롤/리사이즈 시 현재 뷰포트 기준으로 자동 갱신  
5) 확장 아이콘 다시 클릭 → 오버레이 OFF (원복)

## 5. 제품 범위
### 포함
- 현재 탭(활성 탭)에서만 동작
- MV3 기반 Chrome Extension
- 텍스트 위에 말풍선(배지) 오버레이 렌더링
- 뷰포트 기준 “보이는 텍스트”만 표기
- 숨김 처리 요소는 제외:  
  - `display: none`  
  - `visibility: hidden` (사용자 요청의 “display:hidden” 의도를 이걸로 해석)  
  - `opacity: 0`

### 제외 (v0)
- 라인하이트/폰트패밀리 등 추가 스펙 표기
- 클릭/선택/인스펙터 모드(hover만 표시 등)
- 리포트 저장/내보내기
- 페이지별 룰/프리셋 관리
- 폰트 스펙 diff 비교 기능

## 6. 기능 요구사항

### 6.1 토글
- 확장 아이콘 클릭으로 오버레이 ON/OFF 토글
- ON 상태에서 재클릭 시 즉시 제거
- 페이지 새로고침 시 기본 OFF (v0 기준)

### 6.2 “보이는 텍스트” 판정 로직
아래 조건을 **모두 만족**하는 텍스트만 표시한다.

**A. 뷰포트 교차**
- 요소의 bounding rect가 뷰포트와 교차해야 함(일부라도 보이면 포함)

**B. 실제 텍스트 존재**
- 공백 제거 후 텍스트가 1자 이상 존재해야 함  
- 기준 텍스트는 “렌더링되는 텍스트 노드 기반”으로 판단 (v0: DOM 텍스트 노드 중심)

**C. 숨김 제외**
- 계산된 스타일 기준으로 다음은 제외:
  - `display: none`
  - `visibility: hidden`
  - `opacity: 0`

> 주의: `display:hidden`은 유효한 CSS가 아니므로 `visibility:hidden`으로 간주한다.

### 6.3 배지(말풍선) 표시
- 표시 정보: `font-size` / `font-weight` / `color`
- 위치: 해당 텍스트 요소의 화면 좌상단 근처(겹침 최소화는 v0에서 “간단히” 처리)
- 배지는 페이지 클릭/스크롤 상호작용을 방해하지 않음(pointer-events 없음)
- 오버레이는 페이지 DOM/레이아웃에 영향 주지 않음(고정 레이어)

### 6.4 자동 갱신 트리거
- `scroll`, `resize` 발생 시 갱신
- **성능을 위해 갱신은 1000ms 디바운싱 적용** (이벤트가 연속 발생해도 마지막 이벤트 이후 1000ms에 1회만 렌더)
- DOM 변경이 많은 페이지를 위해 최소한의 관찰(옵션):
  - MutationObserver로 “갱신 예약” 정도만 수행
  - **MutationObserver에 의한 갱신도 동일하게 1000ms 디바운싱 적용**

### 6.5 성능 안전장치
- 텍스트가 과도하게 많을 때 브라우저 프리즈를 막기 위한 상한 필요
  - v0: 최대 N개 배지까지만 표시(예: 800개). 초과 시 추가 생성 중단.

## 7. 비기능 요구사항

### 7.1 성능
- 일반 랜딩페이지에서 스크롤 시 체감 지연 최소
- 갱신은 requestAnimationFrame 기반으로 1프레임에 1회 이하로 제한(스로틀)

### 7.2 안정성
- 오버레이가 페이지의 이벤트/스타일과 충돌하지 않도록:
  - 독립 root 컨테이너 사용
  - 매우 높은 z-index
  - pointer-events none

### 7.3 권한 최소화
- 현재 활성 탭에서만 동작
- 필요한 권한만 사용: activeTab / scripting (v0 기준)

## 8. 엣지 케이스 처리 기준 (v0)
- 중첩 텍스트(부모/자식에 텍스트가 혼재):  
  - “텍스트 노드의 부모 요소” 단위로 중복 제거(Set) 후 표시
- 매우 작은 요소/0 크기 rect: 제외
- `opacity: 0`인 상위 부모로 인해 실제로 안 보이는 경우:  
  - v0는 “요소 자체의 computed style” 기준으로만 제외(단순)  
  - 상위까지 추적하는 완전한 가시성 판정은 v1 후보
- iframe:
  - same-origin iframe은 가능하면 포함(선택)  
  - cross-origin iframe은 접근 불가 → 제외(명시)
- Shadow DOM:
  - v0는 미지원(명시). 추후 필요 시 open shadowRoot만 탐색하는 v1 후보.
- pseudo-element 텍스트(`::before/::after` content):
  - v0는 미지원(명시)

## 9. 수용 기준 (Acceptance Criteria)
- 오버레이 ON 시, 뷰포트 내 보이는 텍스트 요소 위에 `font-size / font-weight / color`가 표시된다.
- `display:none` / `visibility:hidden` / `opacity:0`인 텍스트는 표시되지 않는다.
- 스크롤/리사이즈 후 배지가 현재 뷰포트 기준으로 갱신된다.
- 오버레이는 클릭/스크롤 등 사용자 상호작용을 방해하지 않는다.
- OFF 시 오버레이가 완전히 제거되어 페이지에 잔여 DOM/스타일 영향이 없다.
- 텍스트가 많은 페이지에서도 브라우저가 멈추지 않도록 상한이 적용된다.

## 10. QA 체크리스트(최소)
- 다양한 폰트 사이즈(px/rem/em)에서 표시값 확인 (computed style 결과)
- font-weight가 400/700뿐 아니라 500/600 등에서도 정상 표시
- color가 hex 형식으로 정상 표시 (rgb → hex 변환)
- 숨김 케이스: display none / visibility hidden / opacity 0
- 스크롤이 긴 페이지에서 갱신 정상
- fixed/sticky 헤더 아래 텍스트에서 배지 위치 확인
- 모바일 뷰(디바이스 툴바)에서 리사이즈/회전 시 갱신

## 11. 오픈 질문(답 필요)
1) `opacity: 0.01` 같은 “거의 안 보임”도 제외할까, 아니면 정확히 `opacity: 0`만 제외할까?  
2) 배지 최대 표시 개수 상한(N)을 얼마로 둘까? (기본 800 제안)  
3) same-origin iframe 내부 텍스트도 포함할까? (cross-origin은 불가)
